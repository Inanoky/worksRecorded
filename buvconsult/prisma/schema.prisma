// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider      = "prisma-client-js"  
  binaryTargets = ["native", "linux-musl", "rhel-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                            String  @id @unique
  email                         String
  phone                         String?
  firstName                     String
  lastName                      String
  profileImage                  String
  customerId                    String? @unique
  lastSelectedSiteIdforWhatsapp String? // <-- add this field!

  createdAt DateTime @default(now())

  Site             Site[]
  posts            Post[]
  Invoices         Invoices[]
  Documents        Documents[]
  sitediaryrecords sitediaryrecords[] // one user can have many site diary records

  Subscription      Subscription?
  AIconversation    AIconversation[] // User can have many conversations
  sitediarysettings sitediarysettings[]
  photos            photos[]
}

model Site {
  id           String   @id @default(uuid())
  name         String
  description  String
  subdirectory String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  imageUrl          String?
  User              User?              @relation(fields: [userId], references: [id])
  userId            String?
  posts             Post[]
  invoices          Invoices[]
  InvoiceItems      InvoiceItems[]
  Documents         Documents[]
  photos            photos[] // on site can have many photos
  timelog           timelog[] // on site can have timelogs
  sitediaryrecords  sitediaryrecords[] // one site can have many site diary records
  AIconversation    AIconversation? // Site can have one conversation
  sitediarysettings sitediarysettings? //One site can have one site diary setting
  workers           workers[] //on site can have many workers 
}

model Subscription {
  stripeSubscriptionId String   @id @unique
  interval             String
  status               String
  planId               String
  currentPeriodStart   Int
  currentPeriodEnd     Int
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  User   User?   @relation(fields: [userId], references: [id])
  userId String? @unique
}

model Invoices {
  id                              String   @id @default(cuid())
  url                             String
  invoiceNumber                   String?
  sellerName                      String?
  invoiceTotalSumNoVat            Float?
  invoiceTotalSumWithVat          Float?
  buyerName                       String?
  invoiceDate                     String?
  paymentDate                     String?
  isInvoice                       Boolean?
  isCreditDebitProformaOrAdvanced String?

  uploadedAt DateTime @default(now())

  User   User?          @relation(fields: [userId], references: [id])
  userId String?
  Site   Site?          @relation(fields: [SiteId], references: [id], onDelete: Cascade)
  SiteId String?
  items  InvoiceItems[]
}

model Post {
  id               String   @id @default(uuid()) // Unique identified, msut have
  title            String
  articleContent   Json
  smallDescription String
  image            String
  slug             String   @unique
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  User   User?   @relation(fields: [userId], references: [id])
  userId String?
  Site   Site?   @relation(fields: [siteId], references: [id], onDelete: Cascade) // 06:16 - onDelete added
  siteId String?
}

model InvoiceItems {
  // Invoice items
  id String @id @default(uuid())

  item                  String?
  quantity              Float?
  unitOfMeasure         String?
  pricePerUnitOfMeasure Float?
  sum                   Float?
  currency              String?
  category              String?
  itemDescription       String?
  commentsForUser       String?
  isInvoice             Boolean?
  invoiceId             String
  invoice               Invoices @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  Site                  Site?    @relation(fields: [siteId], references: [id], onDelete: Cascade)
  siteId                String?

  // Invoice information

  invoiceNumber String?
  sellerName    String?
  // invoiceTotalSumNoVat   Float?
  // invoiceTotalSumWithVat Float?
  // buyerName              String?
  invoiceDate   String?
  paymentDate   String?
}

model AIconversation {
  id     String @id @default(uuid())
  thread Json?
  userId String
  User   User?  @relation(fields: [userId], references: [id], onDelete: Cascade)
  siteId String @unique
  site   Site?  @relation(fields: [siteId], references: [id], onDelete: Cascade)

  @@unique([userId, siteId])
}

model Documents {
  id           String  @id @default(uuid())
  url          String
  documentType String
  documentName String
  description  String
  User         User?   @relation(fields: [userId], references: [id])
  userId       String?
  Site         Site?   @relation(fields: [siteId], references: [id], onDelete: Cascade) // 06:16 - onDelete added
  siteId       String?
}

model sitediaryrecords {
  id              String    @id @default(uuid())
  User            User?     @relation(fields: [userId], references: [id])
  userId          String?
  Site            Site?     @relation(fields: [siteId], references: [id], onDelete: Cascade) // 06:16 - onDelete added
  siteId          String?
  Date            DateTime?
  Location        String?
  Works           String?
  Comments        String?
  Units           String?
  Amounts         Float?
  WorkersInvolved Int?
  TimeInvolved    Float?
  Photos          String[]
}

model sitediarysettings {
  id      String  @id @default(uuid())
  User    User?   @relation(fields: [userId], references: [id])
  userId  String?
  fileUrl String?
  Site    Site?   @relation(fields: [siteId], references: [id], onDelete: Cascade)
  siteId  String? @unique // <- Only one settings per site
  schema  String?
}

model photos {
  id       String    @id @default(uuid())
  Date     DateTime?
  URL      String?
  Comment  String?
  Location String?
  User     User?     @relation(fields: [userId], references: [id])
  userId   String?
  fileUrl  String?
  Site     Site?     @relation(fields: [siteId], references: [id], onDelete: Cascade)
  siteId   String?
}



model workers {
  id       String    @id @default(uuid())
  name String?
  surname String?
  personalId String?
  Site     Site?     @relation(fields: [siteId], references: [id], onDelete: Cascade)
  siteId   String?
  phone     String?
  isClockedIn Boolean?
  timelog timelog[]
}

model timelog {
  id       String    @id @default(uuid())
  workers  workers?     @relation(fields: [workerId], references: [id], onDelete: Cascade)
  workerId   String?
  Site     Site?     @relation(fields: [siteId], references: [id], onDelete: Cascade)
  siteId   String?
  date DateTime?
  clockIn DateTime?
  clockOut DateTime?
  wocation String?
  works String?



}